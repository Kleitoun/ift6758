---
layout: post
title: Milestone 1
---
<div style="text-align: justify">
This page focuses on the discussions based on the problem statements mentioned in Milestone-1 of the Project for IFT 6758.
    </div>

# Warm-up

### 1.1

<div style="text-align: justify">
The goal here is to compare the best ten goalies of the 2017-2018 season using their save percentage (SV%). The main problem is that goalies who performed well over a very small number of games end up near the top of the list. Looking at the data, we see that out of the top ten goalies, seven of them had played five or less games during that season. On top of that, two others had each 17 and 32 games, which is still less than half of the regular season games (a regular season has 82 games). If a specific goalie's sample size is too small, we don't want to include him in a list of top performing goalies. One simple filter would be to only keep goalies who played in at least half of the games (i.e. GP >= 41). 
</div>
  
### 1.2
<div style="text-align: justify">
We have now filtered out the goalies using our proposed approach (only keep those with GP >= 41) and have displayed them using a bar plot. 
</div>

<img src="./figures/question_1_2.png"/>

<!-- ![image](./figures/question_1_2.png) -->
    
### 1.3
<div style="text-align: justify">
We are provided with advanced data that allow us to look at what are called "even strength scoring chance metrics". These statistics are used to give us more intel on the goalie's performance with regards to other metrics. <br>
First of all, there is the xGA, which is the expected number of goals allowed based on shots faced from a given location against the average shooting percentage from that location. A smaller number shows that the goalie has stopped more shots from a given location than the rest of the league. <br>
There is also the scSV%, which shows the ratio of good scoring chances stopped. A good scoring chance is a shot that has a value of 2, meaning that the shot is taken close to the goal but not right in front of it. <br>
Finally, there is the HDsc SV%, which is the ratio of high danger chances stopped. A high danger shot is one taken very close to the goalie, in front of him. Usually, these are the hardest to stop due to the velocity of the puck and often times, the presence of other players in front of the goalie, greatly reducing his vision. 

<br><br>
These three metrics, on top of the regular SV% (save percentage), constitute good indicators to determine a goalie's performance. 
</div>

# Data Acquisition

This section is a short tutorial on downloading the play-by-play data from both the regular seasons and the playoffs, using the NHL API.

### API Endpoint

The primary endpoint we use to fetch this data is 

```markdown
---
https://statsapi.web.nhl.com/api/v1/game/[GAME_ID]/feed/live/
---
```
<div style="text-align: justify">
As we can see that the only argument the API inputs is the game_ID. This game_ID is a 10-digit identifier where the first 4 digits correspond to the season, next 2 digits indicate the type of the game where 02= regular season and 03=playoffs. The final 4 digits identify the specific game number. For playoff games, the 2nd digit of the specific number gives the round of the playoffs, the 3rd digit specifies the matchup, and the 4th digit specifies the game (out of 7).
    </div>

### API Requests

<div style="text-align: justify">
We use python's requests library to fetch game data for a given Game ID.
    </div>

```python
def get_file(game_id, folder_path):
    """
    Check if file is already downloaded.
        If yes, return the file path
        If not, check if it exists on the nhl api.
            If it does, save it locally and return the path
            If it doesn't, return None
    """
    
    file_path = folder_path + str(game_id) + '.json'
    if not os.path.isfile(file_path):
        data = requests.get(f'https://statsapi.web.nhl.com/api/v1/game/{game_id}/feed/live/')
        if (data.status_code == 404):
            return None
        with open(file_path, 'w') as f:
            json.dump(data.json(), f)
            
    return file_path
```
<div style="text-align: justify">
Notice, that we're sending the request only if a JSON for the corresponding game_ID has not already been fetched.
    </div>

### Forming the Game IDs
<div style="text-align: justify">
For the regular season, the game ID has the following structue:
    </div>

```python
game_id = int(f'{season}{game_type}{game_number.zfill(4)}')
```
<div style="text-align: justify">
While for the playoffs, the logic is
</div>
```python
game_id = int(f'{season}{game_type}{playoff_round.zfill(2)}{matchup}{game_number}')
# where the game_number is out of 7
```

<div style="text-align: justify">
Finally,
We then iterate over the game numbers to form game_IDs as required and fetch the live data using the API endpoint.
To enable analysis on this data and avoid redundant calls to the API, we dump the result into an individual JSON each time.
    </div>

# Interactive Debugging tool

... debugging tool screenshot ... 

# Tidy Data

### 4.1
![image](./figures/question_4_1.png)

### 4.2

<div style="text-align: justify">
By looking at the 'Penalty' and 'Goal' events we can logically deduce the strength at any given time in the game (by looking at penalty times, goals, etc). For example, a minor penalty usually lasts 2 minutes, unless the opposing team scores a goal, in which case it ends early. We can use this logic (along with some manipulations related to period number and time) to build a table which contains the strength at every second of each game. Then, when we have the events data, we can get the strengh for each event by joining that table. See screenshot of cell below for sample penalty event: 
    </div>

![image](./figures/question_4_2.png)

### 4.3

<div style="text-align: justify">
Based on coordinates, you could classify shots as low/high danger or as coming from a particular zone
Shot/goal can be probably be classified as a rebound if there was another shot from the same team $<$ x seconds prior (not 100% accurate though)
We are not sure if there is enough info to reliably method to classify a shot/goal as being off the rush
Anything that can be created from the set of events below: {'Blocked Shot', 'Faceoff', 'Game End', 'Game Official', 'Game Scheduled', 'Giveaway', 'Goal', 'Hit', 'Missed Shot', 'Penalty', 'Period End', 'Period Official', 'Period Ready', 'Period Start', 'Shot', 'Stoppage', 'Takeaway'}
                                                                                                      </div>

# Simple Visualizations

### 5.1 

![image](./figures/question_5_1.png)

### 5.2 

![image](./figures/question_5_2_0.png)

![image](./figures/question_5_2_1.png)

![image](./figures/question_5_2_2.png)

### 5.3

![image](./figures/question_5_3.png)

# Advanced Visualizations

The following interactive plot shows the excess shots pr hours per 100sqft per team per season relative to the league average for that specific season.

{% include question_6_shotmap.html %}


